function alertDialog(e,t){t="undefined"!=typeof t?t:0,t&&(e="<center class='alert-box "+t+"'>"+e+"</center>"),e="undefined"!=typeof e?e:0,e&&$("#dialog-message").html(e),$("#dialog-message").dialog({modal:!0,resizable:!0,width:"400",height:"250",draggable:!1,buttons:{Ok:function(){$("#dialog-message").html(""),$(this).dialog("close")}}})}function fnDataTable(e,t,a,i){cls="undefined"!=typeof i?"#"+i:".dataTable","profil"==a?(search=!1,blen=!1,pagin=!1,info=!1):(search=!0,blen=!0,pagin=!0,info=!0),$(cls).DataTable({pagingType:"full",searching:search,bLengthChange:blen,paging:pagin,info:info,language:{sSearch:"Rechercher : ",lengthMenu:"Lister _MENU_ lignes",info:"Liste de _START_ à _END_ du _TOTAL_ "+a+"s",infoEmpty:"Aucun "+a+" trouvé !",infoFiltered:"   (filtrée parmis _MAX_ "+a+"s)",zeroRecords:"Aucun "+a,thousands:" ",paginate:{first:"« Début",previous:"‹ Précédent",next:"Suviant ›",last:"Fin »"}},buttons:["excel"],order:[[e,t]]})}var idGroup=0,retour_enr_cmp="",parms_gle=new Object,tm_out_rec,tm_out_mgr,tm_out_vou,tm_out_sms,tm_out_data,tm_out_ftp;$(document).ready(function(){function charger_liste(e,t,a){$.ajax({url:a,async:!1,type:"POST",data:{id_nature:t},success:function(t){$("#"+e).html(t)},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}function getIdBonus(){var e=0;return $(".divCntBonus").each(function(){id=$(this).attr("id").replace("divCntBonus",""),id>e&&(e=parseInt(id))}),e+1}function fn_cmp_modif_1(e){$("#dialog-message").load("campagne/generales.php",{idCmp:e}),$("#dialog-message").dialog({modal:!0,resizable:!0,draggable:!0,width:"1000",height:"650",open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Annuler')").focus()},buttons:[{text:"Enregistrer",click:function(){if(verifOngletGle()){parms_gle=new Object,params_gle(),parms_gle.dmd="gle",parms_gle.idCmp=e;var t=$("#fileUploadForm")[0],a=new FormData(t);a.append("cmp",JSON.stringify(parms_gle)),$.ajax({type:"POST",async:!0,dataType:"json",enctype:"multipart/form-data",url:"campagne/modif_save.php",data:a,processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(t){$("#dialog-message").dialog("close"),"1"==t.exec?(alertDialog(t.message,"success"),$('input[name="cmp'+e+'"]').click(),showDetaillCmp(e)):alert(t.message)},error:function(e){alert(a)}}),$(this).dialog("close")}else console.log("Erreur")}},{text:"Annuler",click:function(){$(this).dialog("close")}}]})}function fn_cmp_modif_2(e){alertDialog("En cours de développement","notice")}function fn_cmp_modif_3(e){alertDialog("En cours de développement","notice")}function fn_cmp_modif_5(e){alertDialog("Veuillez choisir onglet modifiable","warning")}function fn_cmp_modif_6(e){alertDialog("Veuillez choisir onglet modifiable","warning")}function fn_cmp_modif_4(e){$("#dialog-message").load("campagne/budget.php",{idCmp:e}),$("#dialog-message").dialog({modal:!0,resizable:!0,draggable:!0,width:"1000",height:"550",open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Annuler')").focus()},buttons:[{text:"Enregistrer",click:function(){parms=new Object,parms.dmd="budget",parms.idCmp=e,$(".budget").each(function(){parms[$(this).attr("name")]=$(this).val()}),$.ajax({type:"POST",async:!1,dataType:"json",url:"campagne/modif_save.php",data:{cmp:JSON.stringify(parms)},success:function(t){$("#dialog-message").dialog("close"),"1"==t.exec?(alertDialog(t.message,"success"),$('input[name="cmp'+e+'"]').click(),showDetaillCmp(e),$("#sky-tab1").attr("checked",!1),$("#sky-tab4").attr("checked","checked")):alert(t.message)},error:function(e){alert(data)}}),$(this).dialog("close")}},{text:"Annuler",click:function(){$(this).dialog("close")}}]})}function fn_testChargementEnCours(){$.ajax({url:"ciblage/test_fin_ciblage.php",dataType:"json",success:function(e){0==e.exec&&(clearInterval(tm_out),$("#dialog-message").html("<center>les données sont téléchargées</center>"))}})}function fn_ciblage(e){var t,a=new Object,i=!1,n="Vous devez ajouter au moins un critére";if($("#cntGrCiblage .critere").removeClass("champVide"),a.tp_dmd=e,a.associationGroupe=$("#cntGrCiblage input:checked[name=associationGroupe]").val(),a.cibleName=$("#idCibleName").val(),$("#cntGrCiblage input:checked.groupe").each(function(){a[$(this).attr("name")]=$(this).val()}),$("#cntGrCiblage .critere").length&&($("#cntGrCiblage .critere").each(function(){$(this).hasClass("ignored")||!$(this).is("input")&&!$(this).is("select")||(i=!0,t=$(this).hasClass("champCiblage")?$(this).val().split(":")[0]:$(this).val(),a[$(this).attr("id")]=t,$(this).val()||($(this).addClass("champVide"),i=!1,n="Merci de remplire tous les champs"))}),i)){var r="",o="",s="";$(".select_for_periode").each(function(){r=$(this).attr("id").replace("idPeriodeFrom_","").replace("idPeriodeTo_",""),o=$("#idPeriodeFrom_"+r).val(),s=$("#idPeriodeTo_"+r).val(),o>s&&(i=!1,$("#idPeriodeFrom_"+r).hasClass("champVide")||($("#idPeriodeFrom_"+r).addClass("champVide"),$("#idPeriodeTo_"+r).addClass("champVide"),n="Periode invalide",alertDialog(n,"error")))})}return i?($("#dialog-message").html("<center><img src = 'img/loading.gif'></center>"),"exp"==e?($("#idInputParms").val(JSON.stringify(a)),$("#exportCiblage").submit(),$("#dialog-message").dialog({modal:!0,width:"700",height:"500",resizable:!0,draggable:!0,open:function(e,t){$(".ui-dialog-titlebar-close").hide()},buttons:[{text:"OK",click:function(){$(this).dialog("close")}}]}),tm_out=setInterval(function(){fn_testChargementEnCours()},1e3)):($("#dialog-message").load("ciblage/calcule_cible.php",{parms:JSON.stringify(a)}),$("#dialog-message").dialog({modal:!0,width:"700",height:"500",resizable:!0,draggable:!0,open:function(e,t){$(".ui-dialog-titlebar-close").hide()},buttons:[{text:"OK",click:function(){$(this).dialog("close")}}]})),!0):(alertDialog(n,"warning"),!1)}function getIdGroup(){var e=0;return $(".divGroupe").each(function(){id=$(this).attr("id").replace("groupe",""),id>e&&(e=parseInt(id))}),e+1}function getIdCritere(){var e=0;return $(".divCritere").each(function(){tab=$(this).attr("id").split("_"),id=tab[2],id>e&&(e=parseInt(id))}),e+1}function showDetaillCmp(e){$("#ligne_campagne_"+e).after('<tr id = "show_cible_'+e+'"  class="detail-campagne" style="background-color:#ababab;" ><td colspan="7"><center><img src = "img/loading.gif"></center></td></tr>'),$.ajax({url:"campagne/showCampagne.php",async:!1,type:"POST",dataType:"text",data:{idCmp:e},success:function(t){$("#show_cible_"+e).html(t),$('input[name="cmp'+e+'"]').removeClass("afficher_det_cmp"),$('input[name="cmp'+e+'"]').addClass("masquer_det_cmp"),$('input[name="cmp'+e+'"]').val("Masquer")},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}function verif_Bonus_glb(e){var t=!0;return"fidelite"!=e||$("#cntBonus select").length||(retour_enr_cmp="Vous devez avoir au moins un bonus",t=!1),$("#cntBonus select").each(function(){""==$(this).val()&&($(this).addClass("champVide"),t=!1)}),$("#cntBonus input:text").each(function(){""==$(this).val()&&($(this).addClass("champVide"),t=!1)}),$(".ShowSMSBonus:checked").each(function(){idTxt=$(this).attr("id").replace("idShowSMSBonus",""),""==$("#idSMSBonusAr"+idTxt).val().trim()&&($("#idSMSBonusAr"+idTxt).addClass("champVide"),t=!1),""==$("#idSMSBonusFr"+idTxt).val().trim()&&($("#idSMSBonusFr"+idTxt).addClass("champVide"),t=!1)}),t}function verif_Declencheur_Bonus(){var e=!0;if($("#cntGrEvent select").each(function(){""==$(this).val()&&($(this).addClass("champVide"),e=!1)}),!e)return!1;if($("#cntGrEvent input:text").each(function(){""==$(this).val()&&($(this).addClass("champVide"),e=!1)}),!e)return!1;if($("#cntGrEvent .divCritere").length||(e=!1,alertDialog("Vous devez avoir au moins un critère de déclenchement de bonus","warning")),!e)return!1;if(e=verif_Bonus_glb("decl"),!e)return!1;var t=0;$(".divGroupe.dgDeclencheur").each(function(){var a=$(this).attr("id"),i=$("#"+a+" .divCntBonus").length;i?t+=i:e=!1});var a=$(".divCntBonus").length;return 0==a||t==a&&!e?(retour_enr_cmp="Vous devez avoir au moins un bonus par groupe, ou bien un bonus global",!1):!0}function verifOngletBonus(){var e=$("#type_declencheur").val();return""==e?!0:"fidelite"==e?verif_Bonus_glb("fidelite"):verif_Declencheur_Bonus()}function verifOngletCiblage(){var e=$('input:radio[name="ciblage_campagne_choix"]:checked').attr("id");if("idSansCible"==e)return!0;if("idChosirCible"==e){if(""==$("#listeCibleCampagne").val()){$("#listeCibleCampagne").addClass("champVide").after("<span id= 'spanlisteCibleCampagne' class='alert-box error'>Choisir l'une des cibles</span>");var t="Merci de choisir une cible !!";return alertDialog(t,"warning"),!1}return!0}var a=verifCiblage();if(a.send)return!0;var t=a.message;return alertDialog(t,"warning"),!1}function verifCiblage(){var e=new Object;if(e.send=!0,e.message="",$("#cntGrCiblage .critere").length){if($("#cntGrCiblage .critere").each(function(){$(this).val()||($(this).addClass("champVide"),e.send=!1,e.message="Merci de remplire tous les champs")}),e.send){var t="",a="",i="";$("#cntGrCiblage .select_for_periode").each(function(){t=$(this).attr("id").replace("idPeriodeFrom_","").replace("idPeriodeTo_",""),a=$("#idPeriodeFrom_"+t).val(),i=$("#idPeriodeTo_"+t).val(),a>i&&(e.send=!1,$("#idPeriodeFrom_"+t).hasClass("champVide")||($("#idPeriodeFrom_"+t).addClass("champVide"),$("#idPeriodeTo_"+t).addClass("champVide"),e.message="Periode invalide"))})}}else e.send=!1,e.message="Vous devez ajouter au moins un critére";return e}function verifOngletGle(){var e=!0;return(""==$("#idNomCampagne").val()||$("#idNomCampagne").val().length<10)&&($("#idNomCampagne").addClass("champVide"),$("#spanidNomCampagne").length||$("#idNomCampagne").after("<span id= 'spanidNomCampagne' class='alert-box error'>Le nom doit contenir au moins 10 caractéres</span>"),e=!1),""!=$("#idDtFromCampagne").val()&&$("#idDtFromCampagne").val().length<16&&($("#idDtFromCampagne").addClass("champVide"),$("#spanidDtFromCampagne").length||$("#idDtFromCampagne").after("<span id= 'spanidDtFromCampagne' class='alert-box error'>Date début incorrecte !!</span>"),e=!1),(""==$("#idDtToCampagne").val()||$("#idDtToCampagne").val().length<16)&&($("#idDtToCampagne").addClass("champVide"),$("#spanidDtToCampagne").length||$("#idDtToCampagne").after("<span id= 'spanidDtToCampagne' class='alert-box error'>Date fin incorrecte !!</span>"),e=!1),(""==$("#idSmsCampagneAr").val()||$("#idSmsCampagneAr").val().length<10)&&($("#idSmsCampagneAr").addClass("champVide"),$("#spanidSmsCampagneAr").length||$("#idSmsCampagneAr").after("<br><span id= 'spanidSmsCampagneAr' class='alert-box error'>SMS doit contenir au mois 40 caractéres !!</span>"),e=!1),(""==$("#idSmsCampagneFr").val()||$("#idSmsCampagneFr").val().length<10)&&($("#idSmsCampagneFr").addClass("champVide"),$("#spanidSmsCampagneFr").length||$("#idSmsCampagneFr").after("<br><span id= 'spanidSmsCampagneFr' class='alert-box error'>SMS doit contenir au mois 40 caractéres !!</span>"),e=!1),e}function fn_infos_ciblage(){var e=new Object;return"idChosirCible"==$('input:radio[name="ciblage_campagne_choix"]:checked').attr("id")?e.cible_id=$("#listeCibleCampagne").val():"idSansCible"==$('input:radio[name="ciblage_campagne_choix"]:checked').attr("id")?e.cible_id=0:(e.associationGroupe=$("#cntGrCiblage input:checked[name=associationGroupe]").val(),e.cibleName=$("#idCibleName").val(),$("#cntGrCiblage input:checked.groupe").each(function(){e[$(this).attr("name")]=$(this).val()}),$("#cntGrCiblage .critere").length&&(send=!0,$("#cntGrCiblage .critere").each(function(){if(t=$(this).hasClass("champCiblage")?$(this).val().split(":")[0]:$(this).val(),$(this).hasClass("multiple")){var t="";$("#"+$(this).attr("id")+" >option").each(function(){""==t?t="('"+$(this).val()+"'":t+=", '"+$(this).val()+"'"}),t+=")"}e[$(this).attr("id")]=t}))),e}function params_gle(){parms_gle.cmp_nom=$("#idNomCampagne").val(),parms_gle.cmp_dt_from=$("#idDtFromCampagne").val(),parms_gle.cmp_dt_fin=$("#idDtToCampagne").val(),parms_gle.cmp_broadcast=$('input:radio[name="broadcast"]:checked').val(),parms_gle.cmp_teasingAr=$("#idSmsCampagneAr").val(),parms_gle.cmp_teasingFr=$("#idSmsCampagneFr").val(),parms_gle.cmp_objectif=$("#idObjectifCampagne").val()}function params_budget(){$("input.budget").each(function(){parms_gle[$(this).attr("name")]=""==$(this).val()?0:$(this).val()})}function params_sms_bns_glb(){parms_gle.cmp_sms_bonusAr="",parms_gle.cmp_sms_bonusFr="",$("#idShowSMSBonusbnsgeneral").length&&$("#idShowSMSBonusbnsgeneral").is(":checked")?(parms_gle.cmp_sms_bonusAr=$("#idSMSBonusArbnsgeneral").val(),parms_gle.cmp_sms_bonusFr=$("#idSMSBonusFrbnsgeneral").val()):$("#idShowSMSBonus1000").length&&$("#idShowSMSBonus1000").is(":checked")&&(parms_gle.cmp_sms_bonusAr=$("#idSMSBonusAr1000").val(),parms_gle.cmp_sms_bonusFr=$("#idSMSBonusFr1000").val())}function fn_infos_generale(){return parms_gle=new Object,params_gle(),params_sms_bns_glb(),params_budget(),parms_gle}function fn_infos_bonus(){var e=new Object;return e.type_dcl=$("#type_declencheur").val(),e.dcl_grp=new Object,$("#cntGrEvent .dgDeclencheur").each(function(){idG=$(this).attr("id"),id=idG.replace("groupe",""),e.dcl_grp[id]=new Object,e.dcl_grp[id].nature=$("#idSelectNatureTrafic"+id).val(),$("#idShowSMSBonus"+id).is(":checked")?(e.dcl_grp[id].sms_bonusAr=$("#idSMSBonusAr"+id).val(),e.dcl_grp[id].sms_bonusFr=$("#idSMSBonusFr"+id).val()):(e.dcl_grp[id].sms_bonusAr="",e.dcl_grp[id].sms_bonusFr=""),e.dcl_grp[id].type=$("#idSelectTypeDonnee"+id).val(),e.dcl_grp[id].dcl=new Object,$("#"+idG+" .divCritere").each(function(){idc=$(this).attr("id").replace("critere",""),e.dcl_grp[id].dcl[idc]=new Object,e.dcl_grp[id].dcl[idc].code=$("#idTypeCompteur"+idc).val().split(":")[0],e.dcl_grp[id].dcl[idc].type_donnee=$("#natureType"+idc).val().split("_")[1],e.dcl_grp[id].dcl[idc].operateur=$("#operateur"+idc).val(),e.dcl_grp[id].dcl[idc].valeur=$("#valeurCritere"+idc).val(),e.dcl_grp[id].dcl[idc].unite=$("#untieValeur"+idc).val()}),e.dcl_grp[id].bns=new Object,$("#"+idG+" .divCntBonus").each(function(){idBonus=$(this).attr("id").replace("divCntBonus",""),e.dcl_grp[id].bns[idBonus]=new Object,e.dcl_grp[id].bns[idBonus].type=$("#idTypeBonus"+idBonus).val(),e.dcl_grp[id].bns[idBonus].nature=$("#idSelectNatureBonus"+idBonus).val(),e.dcl_grp[id].bns[idBonus].code_bonus=$("#idSelectCompteur"+idBonus).val(),e.dcl_grp[id].bns[idBonus].valeur=$("#idValeurBonus"+idBonus).val(),e.dcl_grp[id].bns[idBonus].ch_ref="",e.dcl_grp[id].bns[idBonus].unite=$("#idUniteCompteur"+idBonus).val()})}),e.bnsGlb=new Object,$("#cntBonus .divCntBonus").each(function(){id=$(this).attr("id").replace("divCntBonus",""),e.bnsGlb[id]=new Object,e.bnsGlb[id].type=$("#idTypeBonus"+id).val(),e.bnsGlb[id].nature=$("#idSelectNatureBonus"+id).val(),e.bnsGlb[id].code_bonus=$("#idSelectCompteur"+id).val(),e.bnsGlb[id].valeur=$("#idValeurBonus"+id).val(),e.bnsGlb[id].ch_ref="",e.bnsGlb[id].unite=$("#idUniteCompteur"+id).val()}),e}function fn_enregistrer_campagne(){var e=new Object;e.glb=fn_infos_generale(),e.cbl=fn_infos_ciblage(),e.bns=fn_infos_bonus();var t=$("#fileUploadForm")[0],a=new FormData(t);a.append("cmp",JSON.stringify(e)),$("#dialog-message").html("<center><br><br>Enregistrement en cours !!!<br><img src = 'img/loading.gif'></center>"),alertDialog(),$.ajax({type:"POST",async:!0,dataType:"json",enctype:"multipart/form-data",url:"campagne/enregistrer_campagne.php",data:a,processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(e){$("#dialog-message").dialog("close"),"1"==e.exec?alertDialog(e.message,"success"):(alertDialog(e.message,"error"),$("#idEnrgistrerCampagne").show())},error:function(e){$("#dialog-message").dialog("close"),$("#dialog-message").html(a),$("#idEnrgistrerCampagne").show(),alertDialog()}})}lgSMS="Fr",$("#username").focus(),$(document.body).on("focus",".datetimepicker",function(){$(this).datetimepicker({dateFormat:"yy-mm-dd",minDate:0,timeFormat:"HH:mm",showSecond:!1,currentText:"Maintenant",closeText:"Valider",timeText:"Horaire",hourText:"Heur",minuteText:"Minute",prevText:"Précédent",nextText:"Suivant",monthNames:["Janvier","Février","Mars","April","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesMin:["Di","Lu","Ma","Me","Je","Ve","Sa"]})}),$(document.body).on("focus",".datepicker",function(){$(this).datepicker({dateFormat:"yy-mm-dd",autoSize:!0,defaultDate:0,changeMonth:!0,changeYear:!0,yearRange:"2000:2017",firstDay:1,maxDate:0,currentText:"Maintenant",nextText:"Suivant",prevText:"Précédent",monthNames:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthNamesShort:["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aou","Sep","Oct","Nov","Dec"],dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesMin:["Di","Lu","Ma","Me","Je","Ve","Sa"]})}),$(document.body).on("change keypress",".champVide",function(e){$(this).removeClass("champVide");var t=$(this).attr("id");$("#span"+t).length&&$("#span"+t).remove()}),$(document.body).on("keypress",".chiffre",function(e){!e&&window.event&&(e=window.event),(e.keyCode<48||e.keyCode>57)&&7!=e.keyCode&&8!=e.keyCode&&9!=e.keyCode&&46!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&36!=e.keyCode&&35!=e.keyCode&&(e.returnValue=!1,e.cancelBubble=!0),(e.which<48||e.which>57)&&0!=e.which&&8!=e.which&&(e.preventDefault(),e.stopPropagation())}),$(document.body).on("keypress",".chiffrePoint",function(e){!e&&window.event&&(e=window.event),(e.keyCode<48||e.keyCode>57)&&7!=e.keyCode&&8!=e.keyCode&&9!=e.keyCode&&46!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&36!=e.keyCode&&35!=e.keyCode&&46!=e.keyCode&&(e.returnValue=!1,e.cancelBubble=!0),(e.which<48||e.which>57)&&0!=e.which&&8!=e.which&&46!=e.which&&(e.preventDefault(),e.stopPropagation())}),$(document.body).on("change","#nature_kpi",function(){var e=$(this).val();$('#nature_kpi option[value=""]').remove(),$.ajax({url:"campagne/kpi_td.php",async:!1,type:"POST",data:{idNature:e},success:function(e){$("#type_kpi").html(e),$("#unite_kpi").html("")},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("change","#type_kpi",function(){var e=$(this).val();$('#type_kpi option[value=""]').remove(),$.ajax({url:"campagne/kpi_unite.php",async:!1,type:"POST",data:{idTd:e},success:function(e){$("#unite_kpi").html(e)},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("click","#idAffichageKPI",function(){var e=$("#idCmpHidden").val(),t=$("#type_kpi").val(),a=$("#unite_kpi").val(),i=!0;""==e&&(i=!1),""==t&&($("#type_kpi").addClass("ChampVide"),i=!1),""==a&&($("#unite_kpi").addClass("ChampVide"),i=!1),i&&$.ajax({url:"campagne/kpi_details.php",async:!1,type:"POST",data:{idCmp:e,idTd:t,unite:a},success:function(e){$("#divStatsGlobal").html(e)},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("change","#nature_stats_client",function(){var e=$(this).val(),t="",a="";$.each(jsn_type[e],function(e,i){""==a&&(a=i),t+="<option value = '"+i+"'>"+e+"</option>"}),$("#type_donnee_stats_client").html(t),t="",$.each(jsn_compteur[a],function(e,a){t+="Total"==a||"Consommation_total"==a||"Data_attribut_profil_all"==a||"All"==a.substring(0,3)?"<option value = '"+a+"' selected>"+e+"</option>":"<option value = '"+a+"'>"+e+"</option>"}),$("#compteurs_stats_client").html(t),$("#compteurs_stats_client").multipleSelect(),t="";var i;$.each(jsn_unite[a],function(e,a){i=60==e||100==e||1048576==e?" selected ":"",t+="<option value = '"+e+"' "+i+">"+a+"</option>"}),$("#unite_stats_client").html(t)}),$(document.body).on("change","#type_donnee_stats_client",function(){var e=$(this).val(),t="",a="";$.each(jsn_compteur[e],function(e,i){""==a&&(a=i),t+="Total"==i||"Consommation_total"==i||"Data_attribut_profil_all"==i||"All"==i.substring(0,3)?"<option value = '"+i+"' selected>"+e+"</option>":"<option value = '"+i+"'>"+e+"</option>"}),$("#compteurs_stats_client").html(t),$("#compteurs_stats_client").multipleSelect(),t="";var i;$.each(jsn_unite[e],function(e,a){i=60==e||100==e||1048576==e?" selected ":"",t+="<option value = '"+e+"' "+i+">"+a+"</option>"}),$("#unite_stats_client").html(t)}),$(document.body).on("change",".selectNatureTrafic",function(){var e=$(this).hasClass("event")?"campagne/declencheur/type_donnees.php":"ciblage/type_donnees.php",t=$(this).val(),a=$(this).attr("id").replace("idSelectNatureTrafic","idSelectTypeDonnee");charger_liste(a,t,e)}),$(document.body).on("click","#idModPWD",function(){return $("#divPrincipale").html("<br><br><br><center><img src = 'img/loading.gif'></center>"),$("#divPrincipale").load("admin/user/modif_pwd.php"),!1}),$(document.body).on("click",".menuVertical",function(){clearInterval(tm_out_rec),clearInterval(tm_out_vou),clearInterval(tm_out_sms),clearInterval(tm_out_mgr),clearInterval(tm_out_data),clearInterval(tm_out_ftp);var e=$(this),t=$(this).attr("href");if(e.hasClass("lism")||$(".sous-menu").slideUp("normal"),e.hasClass("has-sub")){var a=$(this).next();a.is("ul")&&a.is(":visible")&&($(this).closest("li").removeClass("active"),a.slideUp("normal")),a.is("ul")&&!a.is(":visible")&&($("#cssmenu ul ul:visible").slideUp("normal"),a.slideDown("normal"))}else $("#divPrincipale").html("<br><br><br><center><img src = 'img/loading.gif'></center>"),$("#divPrincipale").load(t+".php");return $(".menuVertical").each(function(){$(this).removeClass("active")}),e.addClass("active"),!1}),$(document.body).on("click",".menu_racc",function(){clearInterval(tm_out_rec),clearInterval(tm_out_vou),clearInterval(tm_out_sms),clearInterval(tm_out_mgr),clearInterval(tm_out_data),clearInterval(tm_out_ftp);for(var e=$(this).attr("href").split("|"),t=0;t<e.length;t++)$("#"+e[t]).click();return!1}),$(document.body).on("click",".menu_admin",function(){clearInterval(tm_out_rec),clearInterval(tm_out_vou),clearInterval(tm_out_sms),clearInterval(tm_out_mgr),clearInterval(tm_out_data),clearInterval(tm_out_ftp);var e=($(this),$(this).attr("name"));return $("#divPrincipale").html("<br><br><br><center><img src = 'img/loading.gif'></center>"),$("#divPrincipale").load(e+".php"),!1}),$(document.body).on("click",".actionUser",function(){var e=$(this);return e.hasClass("edit")?(idUser=e.attr("name").replace("editer",""),$("#divPrincipale").load("admin/user/creer.php",{user:idUser})):e.hasClass("reset")?(idUser=e.attr("name").replace("reset",""),$.ajax({url:"admin/user/reset.php",async:!1,type:"POST",dateType:"json",data:{user:idUser},success:function(e){ret=JSON.parse(e),alertDialog(ret.message,"success")}})):(idUser=e.attr("name").replace("gestion",""),$.ajax({url:"admin/user/gestion.php",async:!1,type:"POST",dateType:"json",data:{user:idUser},success:function(t){ret=JSON.parse(t),"1"==ret.exec&&(e.attr("src","img/"+ret.src+".png"),e.attr("title",ret.title))}})),!1}),$(document.body).on("click",".aff_det_cmp_client",function(){$(".msq_det_cmp_client").each(function(){var e=$(this),t=$(this).attr("name").replace("cmp","");$("#ligne_det_"+t).remove(),e.removeClass("msq_det_cmp_client").addClass("aff_det_cmp_client").val("Afficher")});var e=$(this),t=$("#idNumeroInfos").val(),a=$(this).attr("name").replace("cmp","");$("#ligne_campagne_"+a).after('<tr style="background-color:#ababab;" id="ligne_det_'+a+'"><td colspan="5" id="td_det_'+a+'"><br><center><img src = "img/loading.gif"></center></td></tr>'),$.ajax({url:"campagne/client/det_campagne.php",async:!1,type:"POST",dateType:"json",data:{numero:t,idCmp:a},success:function(t){$("#td_det_"+a).html(t),e.removeClass("aff_det_cmp_client").addClass("msq_det_cmp_client").val("Masquer")}})}),$(document.body).on("click",".msq_det_cmp_client",function(){var e=$(this),t=$(this).attr("name").replace("cmp","");$("#ligne_det_"+t).remove(),e.removeClass("msq_det_cmp_client").addClass("aff_det_cmp_client").val("Afficher")}),$(document.body).on("click",".actionCron",function(){var e=$(this);type=e.attr("name");var t="Activer"==e.attr("title")?"Voulez vous activer le chargement ?":"Voulez vous désactiver le chargement ?";return $("#dialog-message").html("<center class= 'alert-box warning'>"+t+"</center>"),$("#dialog-message").dialog({modal:!0,resizable:!0,draggable:!1,width:"400",height:"250",open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Non')").focus()},buttons:[{text:"Oui",click:function(){$.ajax({url:"admin/plateforme/cron/gestionCron.php",async:!1,type:"POST",dateType:"json",data:{type:type},success:function(e){ret=JSON.parse(e),"1"==ret.exec&&($("#menu_21").click(),$("#dialog-message").dialog("close"))}})}},{text:"Non",click:function(){$(this).dialog("close")}}]}),!1}),$(document.body).on("dblclick",".spanEdit",function(){var e=$(this),t=e.text(),a=e.attr("name"),i=$("span[name=valeur_"+a+"]").text();$("#dialog-message").html("<br>Libellé :<input type = 'text' value ='"+t+"' width=40 id='libelle_"+a+"'/><br><br>            Valorisation : <input type = 'text' value ='"+i+"' size= '5' class='chiffrePoint' id='NewVal_"+a+"'/> UM"),$("#dialog-message").dialog({modal:!0,resizable:!0,draggable:!1,width:"400",height:"300",open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Non')").focus()},buttons:[{text:"Enregistrer",click:function(){var t=$("#libelle_"+a).val(),i=$("#NewVal_"+a).val();$.ajax({url:"admin/plateforme/compteurs/gestionCmpt.php",async:!1,type:"POST",dateType:"json",data:{name:t,valeur:i,idCmpt:a},success:function(n){ret=JSON.parse(n),"1"==ret.exec&&(e.text(t),$("span[name=valeur_"+a+"]").text(i),$("#dialog-message").dialog("close"),alertDialog("Mise a jour faite avec succès","success"))}})}},{text:"Non",click:function(){$(this).dialog("close")}}]})}),$(document.body).on("click",".tag",function(){$("#idSmsCampagne"+lgSMS).insertAtCaret($(this).attr("name"))}),$(document.body).on("click",".tagBns",function(){var e=$(this).parent().attr("id").replace("tags_","");$("#idSMSBonus"+lgSMS+e).insertAtCaret($(this).attr("name"))}),$(document.body).on("focusout",".smsComms",function(){lgSMS=$(this).attr("id").replace("idSmsCampagne","").replace("idSMSBonus","").substring(0,2);var e=$(this);e.attr("cols",40),""!=e.attr("name")&&(spanName=e.attr("name")+"Span",$("span[name="+spanName+"]").hide())}),$(document.body).on("focus",".smsComms",function(){var e=$(this);e.attr("cols",70),""!=e.attr("name")&&(spanName=e.attr("name")+"Span",$("span[name="+spanName+"]").show())}),$(document.body).on("keyup",".smsComms",function(){var e=$(this);""!=e.attr("name")&&(spanName=e.attr("name")+"Span",nbcar=e.val().length,div=e.hasClass("arabic")?70:160,rst=nbcar%div,nbs=(nbcar-rst)/div,rst>0&&nbs++,$("span[name="+spanName+"]").html(nbcar+" Caractéres | "+nbs+" SMS"))}),$(document.body).on("click",".actionCmpt",function(){var e=$(this),t=new Object,a=new Object,i=e.attr("src"),n=e.attr("title"),r=$(this).hasClass("stat")?0:1,o=e.attr("name");return t["img/on1.png"]="img/off1.png",t["img/off1.png"]="img/on1.png",t.Activer="Désactiver",t["Désactiver"]="Activer",a["img/on1.png"]="Voulez vous désactivez le compteur ?",a["img/off1.png"]="Voulez vous activez le compteur ?",$("#dialog-message").html('<span class="alert-box warning">'+a[i]+"</span>"),$("#dialog-message").dialog({modal:!0,resizable:!0,draggable:!1,width:"400",height:"220",open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Non')").focus()},buttons:[{text:"Oui",click:function(){$.ajax({url:"admin/plateforme/compteurs/gestionCmpt.php",async:!1,type:"POST",dateType:"json",data:{idCmpt:o,stat:r,action:n},success:function(a){ret=JSON.parse(a),"1"==ret.exec&&(e.attr("src",t[i]),e.attr("title",t[n]),$("#dialog-message").dialog("close"),alertDialog("Mise a jour faite avec succès","success"))}})}},{text:"Non",click:function(){$(this).dialog("close")}}]}),!1}),$(document.body).on("click","#idEnregistrerWF",function(){var e=new Object;$(".wfv").each(function(){e[$(this).attr("name")]=$(this).val()}),$.ajax({url:"admin/wf/save.php",async:!1,type:"POST",dateType:"json",data:{wf:JSON.stringify(e)},success:function(e){ret=JSON.parse(e),"1"==ret.exec&&alertDialog("Mise a jour faite avec succès","success")}})}),$(document.body).on("click",".addValidator",function(){var e=$("#idTableAddWF tr:last select").val(),t=$("#idTableAddWF tr:last select").html();$("#idTableAddWF tr:last select > option").length>1?(tr=$("#idTableAddWF tr").length-1,$("#idTableAddWF").append('<tr><th align="right">Validateur N° '+tr+'</th><td colspan=2><select name="'+tr+'" class="wfv">'+t+"</select></td></tr>"),$("#idTableAddWF tr:last option[value="+e+"]").remove(),$("#idTableAddWF tr:last select").width("204px")):alertDialog("Impossible","error")}),$(document.body).on("change",".wfv",function(){var e=1*$(this).attr("name");$(".wfv").each(function(){1*$(this).attr("name")>e&&$(this).parent().parent().remove()})}),$(document.body).on("click",".actionProfil",function(){var e=$(this);return e.hasClass("edit")?(idProfil=e.attr("name").replace("editer",""),$("#divPrincipale").load("admin/profil/creer.php",{profil:idProfil})):e.hasClass("img_action_profil")?(src=e.attr("src").replace("1.png","").replace("img/",""),newSrc="on"==src?"img/off1.png":"img/on1.png",e.attr("src",newSrc)):e.hasClass("wf")?(idProfil=e.attr("name").replace("wf",""),$("#divPrincipale").load("admin/wf/creer.php",{profil:idProfil})):(idProfil=e.attr("name").replace("gestion",""),$.ajax({url:"admin/profil/gestion.php",async:!1,type:"POST",dateType:"json",data:{profil:idProfil},success:function(t){ret=JSON.parse(t),"1"==ret.exec&&(e.attr("src","img/"+ret.src+".png"),e.attr("title",ret.title))}})),!1}),$(document.body).on("click","#idEnregistrerProfil",function(){var e=new Object,t=!0,a=$(this);""==$("#name_profil").val().trim()?($("#name_profil").addClass("champVide").after("<span id='spanname_profil'> Champ obligatoire</span>"),t=!1):e.name_profil=$("#name_profil").val().trim(),t&&$(".nv_profil").each(function(){id=$(this).attr("id"),e[id]=$(this).attr("src").replace("1.png","").replace("img/","")}),e.id=$("#id_profil").val().trim(),t&&$.ajax({url:"admin/profil/save.php",async:!1,type:"POST",dateType:"json",data:{profil:JSON.stringify(e)},success:function(e){ret=JSON.parse(e),"1"==ret.exec?($("#spanRetour").html(ret.message).removeAttr("class").addClass("alert-box success"),a.remove()):$("#spanRetour").html(ret.message).removeAttr("class").addClass("alert-box error")},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("click","#enregistrer_nouvel_user",function(){var e=new Object,t=!0,a=$(this);$(".nv_user").each(function(){id=$(this).attr("id"),e[id]=$(this).val(),$("#span"+id).length&&$("#span"+id).remove(),""==$(this).val().trim()&&($(this).addClass("champVide").after("<span id='span"+id+"'> Champ obligatoire</span>"),t=!1)}),t&&$.ajax({url:"admin/user/save.php",async:!1,type:"POST",dateType:"json",data:{user:JSON.stringify(e)},success:function(e){ret=jQuery.parseJSON(e),"object"==typeof ret?"1"==ret.exec?($("#spanRetour").html(ret.message).removeAttr("class").addClass("alert-box success"),a.remove(),$(".nv_user").each(function(){$(this).attr("disabled",!0)})):$("#spanRetour").html(ret.message).removeAttr("class").addClass("alert-box error"):alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("change",".cls_fl",function(){var e=$(this),t=$(this).val();if(id=$(this).attr("name"),t){var a=event.target.files[0],i=new FileReader;i.readAsText(a),i.onload=function(a){var i,n,r=0,o=0,s=a.target.result.replace(/\r/g,"");if(n=s.split("\n"),n&&n.length>0){for(var l=0;l<n.length-1;l++)i="222"+n[l],i=parseInt(i.substr(i.length-11)),22239999999>=i&&i>=2223e7?r++:o++;""!=n[l].trim()&&(i="222"+n[l],i=parseInt(i.substr(i.length-11)),22239999999>=i&&i>=2223e7?r++:o++),o?($("#"+id).html("").removeClass("notice"),
alertDialog("Le fichier contient "+o+" numéros invalides","error"),e.val("")):r?$("#"+id).html(t+" ("+r+" numéros)").addClass("notice"):($("#"+id).html("").removeClass("notice"),alertDialog("Le fichier ne contient pas des numéros valides","error"),e.val(""))}else alertDialog("Fichier vide","error")}}else $("#"+id).html(t).removeClass("notice")}),$(document.body).on("click","#idEnrModPWD",function(){var e=new Object,t=!0,a=$(this);$(".mod_pwd").each(function(){id=$(this).attr("id"),$("#span"+id).length&&$("#span"+id).remove(),""==$(this).val()&&(t=!1,$(this).addClass("champVide").after("<span id='span"+id+"'> Champ obligatoire</span>")),e[$(this).attr("id")]=$(this).val()}),t&&e.nv_pwd!=e.conf_pwd&&(t=!1,$("#conf_pwd").addClass("champVide").after("<span id='spanconf_pwd'> Différent du nouveau PWD</span>")),t&&$.ajax({url:"admin/user/modif_pwd.php",async:!1,type:"POST",dateType:"json",data:{user:JSON.stringify(e)},success:function(e){ret=jQuery.parseJSON(e),"object"==typeof ret?"1"==ret.exec?($("#spanRetour").html(ret.message).removeAttr("class").addClass("alert-box success"),a.remove()):$("#spanRetour").html(ret.message).removeAttr("class").addClass("alert-box error"):alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("change",".unite_periodique",function(){var e=$(this).val(),t=$(this).attr("id").replace("idUnitePeriodique","");$.ajax({url:"ciblage/periode.php",async:!1,type:"POST",data:{idUnite:e},success:function(a){var i=a.split("|");$("#idPeriodeFrom"+t).html(i[1]),$("#idPeriodeTo"+t).html(i[4]),"j"==e&&$("#idLibellePeriode"+t).text("  (31 Jours)"),"m"==e&&$("#idLibellePeriode"+t).text("  (12 Mois)"),"s"==e&&$("#idLibellePeriode"+t).text("  (4 Semaines)"),"a"==e&&$("#idLibellePeriode"+t).text("  (4 Ans)")},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("click",".ajouterCritere",function(){var e=$(this),t=$(this).attr("id").replace("AjouterCritere",""),a=getIdCritere(),i=$("#idSelectNatureTrafic"+t).val(),n=$("#idSelectTypeDonnee"+t).val(),r=$("#idSelectNatureTrafic"+t+" :selected").text(),o=$("#idSelectTypeDonnee"+t+" :selected").text();if(""==i)return $("#idSelectNatureTrafic"+t).addClass("champVide"),alertDialog("Veuillez choisir la nature de trafic","warning"),!1;var s=e.hasClass("declencheur")?"campagne/declencheur/critere.php":"ciblage/critere.php",l=e.hasClass("event")?"event":"";$.ajax({url:s,async:!1,type:"POST",data:{idGroup:t,idCritere:a,nat_tr:i,tp_dn:n,nat_tr_txt:r,tp_dn_txt:o,evnt:l},success:function(a){$("#critereContent"+t).append(a),e.hasClass("declencheur")&&$("#idSelectNatureTrafic"+t+" option:not(:selected)").remove()},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("click",".ajouterDIV",function(){var e=$(this).attr("name").replace("ajouterDiv",""),t=getIdBonus(),a=$("#type_declencheur").val();$.ajax({url:"campagne/bonus/bonus.php",async:!1,type:"POST",data:{idBonus:t,type_d:a,idDivCont:e},success:function(t){$("#divGroupeBonus"+e).append(t)},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("change",".selectNatureBonus",function(){var e=$(this).attr("id").replace("idSelectNatureBonus",""),t=$(this).val(),a=$("#idTypeBonus"+e).val(),i=$(this).parents(".divBonus").attr("id").replace("Bonus",""),n=$("#idSelectNatureTrafic"+i).val(),r=$("#type_declencheur").val();$("#idSelectNatureBonus"+e+' option[value=""]').remove(),$.ajax({url:"campagne/bonus/type_bonus.php",async:!1,type:"POST",data:{natBonus:t,typeBonus:a,idNatureTrafic:n,typeDec:r},success:function(a){ret=JSON.parse(a),"1"==ret.exec?($("#idSelectCompteur"+e).html(ret.cmp),$("#idUniteCompteur"+e).html(ret.unite),"17"==t?$("#label"+e).text("Service :"):$("#label"+e).text("Compteur :")):alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("change",".selectTypeBonus",function(){var e=$(this).attr("id").replace("idTypeBonus",""),t=$(this).val(),a=$(this).parents(".divBonus").attr("id").replace("Bonus",""),i=$("#idSelectNatureTrafic"+a).val();i?$.ajax({url:"campagne/bonus/nature_bonus.php",async:!1,type:"POST",data:{typeBonus:t,idNatureTrafic:i},success:function(t){ret=JSON.parse(t),"1"==ret.exec?($("#idSelectNatureBonus"+e).html(ret.nature),$("#idSelectCompteur"+e).html(ret.cmp),$("#idUniteCompteur"+e).html(ret.unite)):alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}}):($("#idTypeBonus"+e+" option:selected").prop("selected",!1),$("#idTypeBonus"+e).attr("selectedIndex","0"),alertDialog("Merci de sélectionner un type de donnée","error"))}),$(document.body).on("click",".SupBonus",function(){var e=$(this).attr("name").replace("Bonus","");$("#dialog-message").html("<center class= 'alert-box warning'>Voulez vous supprimer ce Bonus ? </center>"),$("#dialog-message").dialog({modal:!0,resizable:!0,draggable:!1,width:"400",height:"250",open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Non')").focus()},buttons:[{text:"Oui",click:function(){$("#divCntBonus"+e).remove(),$(this).dialog("close")}},{text:"Non",click:function(){$(this).dialog("close")}}]})}),$(document.body).on("click",".SupprimerDIV",function(){var e=$(this).attr("name");$("#dialog-message").html("<center class= 'alert-box warning'>Voulez vous supprimer cet élément ? </center>"),$("#dialog-message").dialog({modal:!0,resizable:!0,draggable:!1,width:"400",height:"250",open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Non')").focus()},buttons:[{text:"Oui",click:function(){$("#"+e).remove(),$(this).dialog("close")}},{text:"Non",click:function(){$(this).dialog("close")}}]})}),$(document.body).on("click",".AjouterGroupe",function(){var e=$(this),t=getIdGroup();hEvent=e.hasClass("event")?1:0,e.hasClass("declencheur")?(idCnt="cntGrEvent",url="campagne/declencheur/groupe.php"):(idCnt="cntGrCiblage",url="ciblage/groupe.php"),$.ajax({url:url,async:!1,type:"POST",data:{idGroup:t,hEvent:hEvent},success:function(e){$("#"+idCnt).append(e)},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("click","#btnModifCmp",function(){var id=$('input:radio[name="sky-tabs"]:checked').attr("id"),fn=id.replace("sky-tab","fn_cmp_modif_");idCmp=$(this).attr("name"),eval(fn+"("+idCmp+")")}),$(document.body).on("click",".export_bl, .export_wl, .export_gt",function(){var e=$(this).attr("name"),t=$(this).attr("id");$("#hIdCible").val(e),$("#hwl").val(t),$("#formSendExport").submit()}),$(document.body).on("click",".executer_cible_sv",function(){var e=$(this).attr("name").replace("executer","");$("#dialog-message").html("<center><img src = 'img/loading.gif'></center>"),$("#dialog-message").load("ciblage/executer_cible_sv.php",{idCmp:e}),$("#dialog-message").dialog({modal:!0,width:"700",height:"500",resizable:!0,draggable:!0,open:function(e,t){$(".ui-dialog-titlebar-close").hide()},buttons:[{text:"OK",click:function(){$(this).dialog("close")}}]})}),$(document.body).on("click",".executer_cible",function(){var e=$(this).attr("name").replace("executer","");$("#dialog-message").html("<center><img src = 'img/loading.gif'></center>"),$("#dialog-message").load("ciblage/executer_cible.php",{idCible:e}),$("#dialog-message").dialog({modal:!0,width:"700",height:"500",resizable:!0,draggable:!0,open:function(e,t){$(".ui-dialog-titlebar-close").hide()},buttons:[{text:"OK",click:function(){$(this).dialog("close")}}]})}),$(document.body).on("click",".supprimer_cible",function(){var e=$(this),t=e.attr("name").replace("supprimer","");$("#dialog-message").html("Voulez vous supprimer la cible ?"),$("#show_cible_"+t).addClass("supprimerLinge"),$("#dialog-message").dialog({modal:!0,resizable:!0,draggable:!1,open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Non')").focus()},buttons:[{text:"Oui",click:function(){$.ajax({url:"ciblage/removeCible.php",async:!1,type:"POST",dataType:"json",data:{idCible:t},success:function(e){"1"==e.exec?($("#ligne_cible_"+t).remove(),$("#show_cible_"+t).remove(),$("#dialog-message").dialog("close"),alertDialog(e.message,"succes")):alertDialog(e.message,"error")},error:function(){alertDialog("ERREUR LORS DE LA RECHERCHE DE LA PAGE","error")}})}},{text:"Non",click:function(){$("#show_cible_"+t).removeClass("supprimerLinge"),$(this).dialog("close")}}]})}),$(document.body).on("click","#exportCiblage",function(){return fn_ciblage("exp")?void 0:!1}),$(document.body).on("click","#enregistrerCiblage",function(){""==$("#idCibleName").val().trim()?($("#idCibleName").addClass("champVide"),alertDialog("Merci de saisir un nom pour la cible","warning")):fn_ciblage("enregistrer")}),$(document.body).on("click","#idCalculerCible",function(){fn_ciblage("ciblage")});var tm_out;$(document.body).on("change",".champCiblage",function(){var e=$(this).val(),t=$(this).attr("id").replace("idTypeCompteur_","");$.ajax({url:"ciblage/operateur_categorie.php",async:!1,type:"POST",dataType:"json",data:{code:e,id:t},success:function(e){"1"==e.sucess&&($("#operateur_"+t).html(e.operator),$("#divValRecherchee_"+t).html(e.divValRech))},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("click",".choix_valeur",function(){var e,t,a,i=$(this).attr("src").replace("img/","").replace(".png",""),n=$(this).attr("name");"droite"==i?(e=$("#origine_"+n+" :selected").text(),t=$("#origine_"+n).val(),t&&(a='<option value = "'+t+'" selected>'+e+"</option>",$("#valeurCritere_"+n).append(a),$("#origine_"+n+" option[value='"+t+"']").remove(),$("#valeurCritere_"+n+" > option").removeAttr("selected"),$("#valeurCritere_"+n+" option[value='"+t+"']").attr("selected","selected"))):(e=$("#valeurCritere_"+n+" :selected").text(),t=$("#valeurCritere_"+n).val(),t&&(a='<option value = "'+t+'" selected>'+e+"</option>",$("#origine_"+n).append(a),$("#valeurCritere_"+n+" option[value='"+t+"']").remove(),$("#origine_"+n+" > option").removeAttr("selected"),$("#origine_"+n+" option[value='"+t+"']").attr("selected","selected")))}),$(document.body).on("change",".operateur_ch_ciblage",function(){var e=$(this).val(),t=$(this).attr("id").replace("operateur_",""),a=$("#idTypeCompteur_"+t).val(),i=(a.split(":")[1],$("#valeurCritere_"+t).attr("multiple"));if("in"==e||"not in"==e)"undefined"==typeof i&&$("#valeurCritere_"+t).attr("multiple","multiple"),$("#valeurCritere_"+t).multipleSelect();else if("undefined"!=typeof i){var n=$("#valeurCritere_"+t).clone();$("#divValRecherchee_"+t).html(n),$("#valeurCritere_"+t).removeAttr("multiple").show()}}),$(document.body).on("submit","#formInfosNumero",function(){return $("#idAfficherInfosNumero").click(),!1}),$(document.body).on("click","#idAfficherInfosNumero",function(){var e=$("#idNumeroInfos").val();8==e.length?$("#informationClient").load("infos/infosClient.php",{stats:e}):alertDialog("Merci de remplire un numéro de 8 chiffre","warning")}),$(document.body).on("click","#idAffichageStatsGlobal, #icon_exp_excel",function(){var e=new Object,t=!0,a=$("#nature_stats_client :selected").text();a+=" / "+$("#type_donnee_stats_client :selected").text(),a+=1==$("#compteurs_stats_client :selected").length?" / "+$("#compteurs_stats_client :selected").text():" / Multiple ",a+=" / "+$("#periodicite_stats_client :selected").text(),e.id_button=this.id,e.nature=$("#nature_stats_client").val(),e.type_donnee=$("#type_donnee_stats_client").val(),e.compteurs=$("#compteurs_stats_client").val(),e.periodicite=$("#periodicite_stats_client").val(),e.unite=$("#unite_stats_client").val(),e.unite_lib=$("#unite_stats_client :selected").text(),e.entete=a,$("#idNumeroInfos").length&&(e.numero=$("#idNumeroInfos").val()),null==e.compteurs&&(t=!1),$.each(e,function(e,a){(""==a||"numero"==e&&8!=a.length)&&(t=!1)}),t?"icon_exp_excel"==e.id_button?($("#idInputParms").val(JSON.stringify(e)),$("#frm_exp_excel").submit()):($("#divStatsGlobal").html("<center><img src = 'img/loading.gif'></center>"),$.ajax({url:"stats/stats.php",async:!0,type:"POST",data:{parms:JSON.stringify(e)},success:function(e){$("#divStatsGlobal").html(e)},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})):alertDialog("Merci de sélectionner les stats voulus","warning")}),$(document.body).on("click","#idDeconnexion",function(){$("#dialog-message").html("<center class='alert-box warning'>Voulez vous se déconnecter ?</center>"),$("#dialog-message").dialog({modal:!0,resizable:!0,draggable:!1,width:"400",height:"250",open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Non')").focus()},buttons:[{text:"Oui",click:function(){$(this).dialog("close"),window.location="conn/deconnexion.php"}},{text:"Non",click:function(){$(this).dialog("close")}}]})}),$(document.body).on("click",".reduireDIV",function(){var e="divContent_"+$(this).attr("name"),t="img_reduire_"+$(this).attr("name");$(this).hasClass("reduire")?($("div[name="+e+"]").slideUp(),$(this).removeClass("reduire").addClass("agrandire").attr("title","Agrandir"),$("img[name="+t+"]").attr("src","img/plus.png"),$("div[name="+e+"] .critere").addClass("ignored")):($("div[name="+e+"]").slideDown(),$(this).removeClass("agrandire").addClass("reduire").attr("title","Réduire"),$("img[name="+t+"]").attr("src","img/moins.png"),$("div[name="+e+"] .critere").removeClass("ignored"))}),$(document.body).on("click",".masquer_det_cible",function(){var e=$(this),t=e.attr("name").replace("cible","");$("#show_cible_"+t).remove(),e.removeClass("masquer_det_cible"),e.addClass("afficher_det_cible"),e.val("Afficher")}),$(document.body).on("click",".afficher_det_cible",function(){var e=$(this),t=e.attr("name").replace("cible","");$("#ligne_cible_"+t).after("<tr id='show_cible_"+t+"'><td id='show_cible_td_"+t+"' colspan=5><center><img src = 'img/loading.gif'></center></td></tr>"),e.addClass("masquer_det_cible").removeClass("afficher_det_cible").val("Masquer"),$.ajax({url:"ciblage/showCible.php",async:!0,type:"POST",dataType:"json",data:{idCible:t},success:function(e){if("1"==e.exec){var a=e.message;$("#show_cible_"+t).html(a)}},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("change",".ShowSMSBonus",function(){var e=$(this).attr("id").replace("idShowSMSBonus","");$(this).is(":checked")?$("#divGroupeBonus"+e+" .divCntBonus").length?($("#idSMSBonusAr"+e).slideDown(500),$("#idSMSBonusFr"+e).slideDown(500),$("#tags_"+e).slideDown(500)):($(this).attr("checked",!1),alertDialog("Vous devez definir un bonus","warning")):($("#idSMSBonusAr"+e).slideUp(500),$("#idSMSBonusFr"+e).slideUp(500),$("#tags_"+e).slideUp(500))}),$(document.body).on("change","#type_declencheur",function(){var e=$(this).val(),t=1;"fidelite"!=e&&(t=getIdGroup()),$("#div_detail_declencheur").load("campagne/declencheur/declencheur_type.php",{type:e,idGroup:t})}),$(document.body).on("change",'input:radio[name="ciblage_campagne_choix"]',function(){"idChosirCible"==$(this).attr("id")?$("#idDivCiblabeCampagne").load("campagne/liste_cible.php"):"idComposerCible"==$(this).attr("id")?(idG=getIdGroup(),$("#idDivCiblabeCampagne").load("ciblage/ciblage_corps.php",{enrg:" disabled",idGroup:idG})):$("#idDivCiblabeCampagne").html("")}),$(document.body).on("change","#listeCibleCampagne",function(){var e=$(this).val();""==e?$("#divShowCilbeCreationCampagne").html(""):$.ajax({url:"ciblage/showCible.php",async:!0,type:"POST",dataType:"json",data:{idCible:e},success:function(e){if("1"==e.exec){var t=e.message;$("#divShowCilbeCreationCampagne").html("<table width=100%><tr>"+t+"</tr></table>")}},error:function(){alertDialog("ERREUR, MERCI DE CONTACTER VOTRE ADMINISTRATEUR","error")}})}),$(document.body).on("click","#idEnrgistrerCampagne",function(){var e=$(this);e.hide(),retour_enr_cmp="",verifOngletGle()?verifOngletCiblage()?verifOngletBonus()?fn_enregistrer_campagne():(""==retour_enr_cmp&&(retour_enr_cmp="Merci de faire les corrections !!"),alertDialog(retour_enr_cmp,"error"),$("#b3").click(),e.show()):(""==retour_enr_cmp&&(retour_enr_cmp="Merci de faire les corrections !!"),alertDialog(retour_enr_cmp,"error"),$("#b2").click(),e.show()):(""==retour_enr_cmp&&(retour_enr_cmp="Merci de faire les corrections !!"),alertDialog(retour_enr_cmp,"error"),$("#b1").click(),e.show())}),$(document.body).on("click",".afficher_det_cmp",function(){var e=$(this),t=e.attr("name").replace("cmp","");$(".detail-campagne").each(function(){var e=$(this),t=e.attr("id").replace("show_cible_","cmp");$("input[name="+t+"]").removeClass("masquer_det_cmp").addClass("afficher_det_cmp").val("Afficher"),e.remove()}),showDetaillCmp(t)}),$(document.body).on("click",".masquer_det_cmp",function(){var e=$(this),t=e.attr("name").replace("cmp","");$("#show_cible_"+t).remove(),e.removeClass("masquer_det_cmp"),e.addClass("afficher_det_cmp"),e.val("Afficher")}),$(document.body).on("click",".gererCampagne",function(){var e=$(this),t=e.attr("name").split("_"),a=t[1],i=t[0];switch(i){case"arreter":message="Motif d'arrêt de la campagne";break;case"rejeter":message="Motif de rejet de la campagne";break;case"valider":message="Commentaire validation de la campagne";break;case"pause":message="Motif mise en pause de la campagne";break;default:message="Motif"}var n=message+' :<br><br><textarea cols ="30" rows ="3" id="motifGererCmp"></textarea>';$("#dialog-message").html(n),$("#dialog-message").dialog({modal:!0,width:400,height:300,resizable:!0,draggable:!1,open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Annuler')").focus()},buttons:[{text:"Enregistrer",click:function(){var e=$("#motifGererCmp").val();""!=e?$.ajax({url:"campagne/gestionCampagne.php",async:!1,type:"POST",dataType:"json",data:{idCmp:a,action:i,motif:e},success:function(e){"1"==e.exec?($("#dialog-message").dialog("close"),alertDialog(e.message,"success"),$("#cssmenu a.active").click()):alertDialog(e.message,"error")},error:function(){alertDialog("ERREUR LORS DE LA RECHERCHE DE LA PAGE","error")}}):$("#motifGererCmp").addClass("champVide").after("<br><span id= 'spanmotifGererCmp' class='alert-box error'>Merci de saisir un motif</span>")}},{text:"Annuler",click:function(){$("#show_cible_"+a).removeClass("supprimerLinge"),$(this).dialog("close")}}]})}),$(document.body).on("click",".supprimer_campagne",function(){var e=$(this),t=e.attr("name").replace("supprimer","");$("#dialog-message").html("Voulez vous supprimer la campagne ?"),$("#show_cible_"+t).addClass("supprimerLinge"),$("#dialog-message").dialog({modal:!0,resizable:!0,draggable:!1,open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Non')").focus()},buttons:[{text:"Oui",click:function(){$.ajax({url:"campagne/removeCampagne.php",async:!1,type:"POST",dataType:"json",data:{idCmp:t},success:function(e){"1"==e.exec?($("#ligne_campagne_"+t).remove(),$("#show_cible_"+t).remove(),$("#dialog-message").dialog("close"),alertDialog(e.message,"success")):alertDialog(e.message,"error")},error:function(){alertDialog("ERREUR LORS DE LA RECHERCHE DE LA PAGE","error")}})}},{text:"Non",click:function(){$("#show_cible_"+t).removeClass("supprimerLinge"),$(this).dialog("close")}}]})}),$(document.body).on("click",".valider_campagne",function(){var e=$(this),t=e.attr("name").replace("valider",""),a='Commentaire :<br><br><textarea cols ="30" rows ="3" id="motifGererCmp"></textarea>';$("#dialog-message").html(a),$("#dialog-message").dialog({modal:!0,width:400,height:300,resizable:!0,draggable:!1,open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Annuler')").focus()},buttons:[{text:"Enregistrer",click:function(){var e=$("#motifGererCmp").val();""!=e?$.ajax({url:"campagne/validerCampagne.php",async:!1,type:"POST",dataType:"json",data:{idCmp:t,motif:e},success:function(e){"1"==e.exec?($("#ligne_campagne_"+t).remove(),$("#show_cible_"+t).remove(),$("#dialog-message").dialog("close"),alertDialog(e.message,"success")):alertDialog(e.message,"error")},error:function(){alertDialog("ERREUR LORS DE LA RECHERCHE DE LA PAGE","error")}}):$("#motifGererCmp").addClass("champVide").after("<br><span id= 'spanmotifGererCmp' class='alert-box error'>Merci de saisir un motif</span>")}},{text:"Annuler",click:function(){$(this).dialog("close")}}]})}),$(document.body).on("click",".leg_log",function(){idDiv=$(this).attr("name"),content=$("#"+idDiv).html(),$("#dialog-message").html(content),$("#dialog-message").dialog({modal:!0,width:"600",height:"500",open:function(e,t){$(".ui-dialog-titlebar-close").hide(),$(":button:contains('Non')").focus()},buttons:[{text:"Oui",click:function(){$(this).dialog("close")}}]})}),$(document.body).on("click",".ch_date",function(){var e=$(this),t=e.text();e.hasClass("missing")?(url="admin/supervision/missingFiles.php",colspan=12):(url="admin/supervision/liste_cdrs.php",colspan=19),e.hasClass("details")?(e.removeClass("details").addClass("moins"),$("#ligne_tc_"+t).after('<tr id="details'+t+'"><td colspan="'+colspan+'"><br><center><img src = "img/loading.gif"></center></td></tr>'),$.ajax({url:url,async:!0,type:"POST",dataType:"html",data:{periode:t},success:function(e){$("#details"+t).html('<td colspan="'+colspan+'" bgcolor="gray">'+e+"</td>")},error:function(){alertDialog("ERREUR LORS DE LA RECHERCHE DE LA PAGE","error")}})):($("#details"+t).remove(),e.addClass("details").removeClass("moins"))}),$(document.body).on("click",".clsFile",function(){var e=$(this).attr("name"),t=$(this).hasClass("missing")?"admin/supervision/liste_cdrs_missing.php":"admin/supervision/liste_cdrs_journee.php";$("#dialog-message").html("<center><img src = 'img/loading.gif'></center>"),$("#dialog-message").load(t,{jf:e}),$("#dialog-message").dialog({modal:!0,width:"1250",height:"620",resizable:!0,draggable:!0,open:function(e,t){$(".ui-dialog-titlebar-close").hide()},buttons:[{text:"OK",click:function(){$("#dialog-message").html(""),$(this).dialog("close")}}]})})}),$.fn.insertAtCaret=function(e){return this.each(function(){if(document.selection)this.focus(),sel=document.selection.createRange(),sel.text=e,this.focus();else if(this.selectionStart||"0"==this.selectionStart){var t=this.selectionStart,a=this.selectionEnd,i=this.scrollTop;this.value=this.value.substring(0,t)+e+this.value.substring(a,this.value.length),this.focus(),this.selectionStart=t+e.length,this.selectionEnd=t+e.length,this.scrollTop=i}else this.value+=e,this.focus()})};